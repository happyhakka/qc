#服务注册中心 DC (discovery center)

##主要功能

###服务注册
支持grpc服务的注册，注册信息包括服务名,IP信息,以及一些附件元数据.

###存活检测
当服务意外停止时,客户端需要感知到服务停止,并将服务的IP地址踢出可用的IP地址列表,这里可以使用定时心跳去实现.

###客户端负载均衡
通过服务注册与发布,可以实现一个服务部署多台实例,客户端实现在实例直接的负载均衡,从而实现服务的横向扩展.

###总体架构图
![avatar](https://doc.rpcx.io/part2/registry.png)


###存储引擎
选择基于 etcd v3 实现服务注册与发现, 理由
1. etcd v3支持grpc协议效率高，并且和现有微服务协议保持一致
2. etcd 较 consul 性能更高
3. etcd 应用广: k8s、也适合配置中心


###主要流程
1.服务启动后向etcd注册，并上报自己的监听的端口以及当前的权重因子等信息，且对该信息设置ttl值；

2.服务在ttl的时间内周期性上报权重因子等信息；

3.client端调用服务时向etcd获取信息进行调用，同时监听该服务是否变化(通过watch方法实现)，当新增服务时watch方法监听到变化，
将服务加入可用列表，当服务挂掉时ttl失效，client端检测到变化，将服务踢出调用列表，从而实现服务的动态扩展；

4.client端通过每次变化获取到的权重因子来进行client端的加权调用策略，从而保证后端服务的负载均衡；

